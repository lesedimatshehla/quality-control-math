<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Math Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Load PayPal SDK FIRST -->
    <script src="https://www.paypal.com/sdk/js?client-id=AYwazerdTT9PRde0K9tCmMjTLtuieD08o-EJ4ZqVymNpJoBvBuWgnBryzuXNWo9sohkIaAFRFh461jdg&components=login"></script>
</head>
<body>
    <h1>Math Game</h1>

    {% if session.paypal_user %}
    <p>Welcome, {{ session.paypal_user.name }} ({{ session.paypal_user.email }})</p>
    <a href="{{ url_for('logout') }}">Log out</a>
    {% else %}
    <p>Please log in with PayPal to personalize your experience.</p>
    {% endif %}

    <div id="paypal-login-button"></div>

    <!-- Render PayPal Login Button -->
    <script>
        if (typeof paypal !== "undefined") {
            paypal.Login.render({
                appid: "AYwazerdTT9PRde0K9tCmMjTLtuieD08o-EJ4ZqVymNpJoBvBuWgnBryzuXNWo9sohkIaAFRFh461jdg",
                authend: "live",
                scopes: "openid profile email",
                containerid: "paypal-login-button",
                locale: "en-us",
                returnurl: "https://quality-control-math.onrender.com/login/callback"
            });
        } else {
            console.error("PayPal SDK failed to load.");
        }
    </script>

    <style>
        #paypal-login-button {
            margin: 20px 0;
        }
    </style>

    <p>Coins: {{ coins }} (USD ${{ usd }})</p>

    <form method="POST">
        <label>{{ question }}</label>
        <input type="text" name="answer" autocomplete="off">
        <input type="submit" value="Submit">
    </form>

    <p>{{ feedback }}</p>
    <a href="{{ url_for('cashout') }}">Cash Out to PayPal</a>
</body>
</html>
